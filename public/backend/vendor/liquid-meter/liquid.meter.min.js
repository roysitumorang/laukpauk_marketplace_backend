/**
 * @package  Liquid Meter
 * @author   Okler Themes
 * @license  Licensed under CC BY-NC-ND
 *
 * Copyright (c) 2014
 * Inspired on dribble shot:
 * http://dribbble.com/shots/1069484-Charging-Animation
 */
!function(t){"use strict";function e(t,e){var i=parseInt(t.slice(1),16),n=Math.round(2.55*e||0),r=(i>>16)+n,s=(i>>8&255)+n,o=(255&i)+n;return"#"+(16777216+65536*(255>r?1>r?0:r:255)+256*(255>s?1>s?0:s:255)+(255>o?1>o?0:o:255)).toString(16).slice(1).toUpperCase()}var i={shape:"circle",color:"#82BF41",background:"#4C4C52",stroke:"#23282F",textColor:"#FFFFFF",fontFamily:"Open Sans",fontSize:"24px",fontWeight:"600",liquidOpacity:.9,liquidPalette:["#82BF41"],speed:3e3,animate:!0},n=function(e,i){if("undefined"==typeof Snap)throw"Snap.js not found.";this.meter=t(e),this.options=i,this.options.text=this.meter.text(),this.init()};n.prototype={init:function(){if(this.wrapper=this.meter.parent(".liquid-meter"),!this.wrapper.get(0)){var e=t("<div>").attr({"class":"liquid-meter"});this.wrapper=this.meter.wrap(e).parent()}var i=document.createElementNS("http://www.w3.org/2000/svg","svg");return i.setAttribute("preserveAspectRatio","xMidYMid meet"),i.setAttribute("viewBox","0 0 220 220"),this.wrapper.prepend(i),this.svg=t(i).attr({width:"100%",height:"100%"}),this.frames=[[6,-6,-10,6,13,-10],[6,-5,-13,4,31,-5],[7,-5,-9,0,31,-5],[7,-5,-9,-6,30,-6],[6,-10,-10,-10,33,-4],[8,-4,-8,-13,38,7],[8,-8,-5,-15,55,11],[7,-19,-2,-16,33,16],[3,-23,-2,-16,42,21],[3,-22,7,-18,27,21],[2,-26,15,-18,25,20],[-3,-23,18,-18,26,19],[-6,-40,18,-18,22,22],[-15,-16,23,-13,37,22],[-15,-16,23,-13,37,22],[-17,-16,23,-10,33,22],[-18,-16,23,-10,35,21],[-20,-12,23,-5,34,20],[-22,-13,20,-1,35,22],[-22,-13,20,5,32,21],[-21,-16,19,8,34,15],[-23,-16,16,10,36,9],[-22,-23,13,10,48,0],[-23,-20,13,8,45,-6],[-20,-22,7,10,44,-6],[-20,-22,5,10,42,-7],[-18,-20,0,10,41,-8],[-15,-22,-7,10,41,-8],[-11,-33,-8,10,41,-8],[-7,-36,-6,10,15,-11],[0,-39,-8,10,15,-11],[0,-36,-8,7,15,-11]],this.paper=Snap(i),this.draw(),this.observe(),this.options.animate?this.animate():this.drawFrame(1),this.wrapper.addClass("liquid-meter-loaded"),this},draw:function(){this.value=parseInt(this.meter.val()||this.meter.attr("value"),10);var t=this.paper;this.recipient=t.circle(110,110,95);var i=this.makeGradient(this.options.background);this.recipient.attr({fill:i,stroke:this.options.stroke,strokeWidth:15});var n=t.circle(110,110,87);return n.attr({fill:"#FFFFFF"}),this.liquid=t.path(),this.liquid.attr({id:"front",fill:this.options.color,mask:n,stroke:e(this.options.color,20),strokeWidth:1}),this.label=t.text("50%","50%",[this.value,"%"]),this.label.attr({fill:this.options.textColor,dy:".4em","font-family":this.options.fontFamily,"font-size":this.options.fontSize,"font-weight":this.options.fontWeight,"text-anchor":"middle",stroke:this.options.textColor}),this.label.selectAll("tspan:nth-child(2)").attr({"font-size":"24",stroke:"none"}),this},observe:function(){var e=this;this.meter.on("change",function(){e.set(t(this).val())})},set:function(t){var e=parseInt(t,10);this.meter.val(e),this.value=e,this.label.node.textContent=e+"%"},liquidPalette:function(t){this.options.liquidPalette=t},background:function(t){this.options.background=t},stroke:function(t){this.options.stroke=t},color:function(t){this.options.color=t,this.liquid.attr({fill:this.options.color,stroke:e(this.options.color,20)})},makeGradient:function(t){return this.paper.gradient(Snap.format("L(0, 0, 100, 100){color.top}-{color.bottom}",{color:{top:e(t,6),bottom:t}}))},makePath:function(t,e,i,n,r,s,o){var a=1.76*(100-t)+22;return Snap.format("M0,{left} C{curve.x1},{curve.y1} {curve.x2},{curve.y2} 220,{right} L220,220 L0,220 z",{left:a-(e||0),right:a-(r||0),curve:{x1:i+a,y1:n+a,x2:s+a,y2:o+a}})},drawFrame:function(t){var e=this.frames[t-1],i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5];this.liquid.attr({d:this.makePath(this.value,i,n,r,s,o,a)})},animate:function(){function t(){i(function(){e()}),setTimeout(t,r)}function e(){o(s),s++,n>s||(s=1)}var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,0)},n=this.frames.length,r=this.options.speed/n,s=1,o=this.drawFrame.bind(this);return t(),this}},t.fn.liquidMeter=function(e,r){var s="string"==typeof e&&!!r;return s||(e=t.extend({},i,e)),this.map(function(){var i=t(this).data("liquid-meter");return i||(i=new n(this,e),t(this).data("liquid-meter",i)),s&&i[e](r),i})}}(jQuery);
